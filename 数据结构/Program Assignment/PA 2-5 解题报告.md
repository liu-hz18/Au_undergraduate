# **PA 2-5 解题报告**

##### 刘泓尊   2018011446   计84

### 一、数据结构与算法构思

#### 1.数据结构——kd树

##### **1.1 思路来源**

​	一开始我根据提示采用了线段树套线段树的做法，但可惜经过很多优化之后时间依然较长。看到课程微信群中有同学使用kd树的时间更短，因此我决定采用kd树。

##### **1.2 参考资料**

​		课程讲义kd-tree一节09-B5

##### **1.3 思路**

​		kd树每个节点有如下信息：节点代表区间的左边界、右边界、上边界、下边界、温度最大值、温度最小值。

**1.3.1 建树 **

​		由于只有建树过程中可以使用x[],y[],t[]数组，考虑到qsort对某维度数据排序的时候，其他两个信息并不能同步进行变动，因此我设置了rank数组作为映射，每次对x或y进行排序时，实际上只是把rank进行了排序(rank数组 存储原始数据的下标根据某一维排序之后的新rank,这样可以不同时改变三个数组的对应值)。

​		之后按照kdtree的经典做法，隔层依次对x,y维度进行建树，递归子树之前设置节点代表的上下左右范围，递归回溯过程中初始化最大温度和最小温度，完成建树。

**1.3.2 问询 **

​		基于讲义09-B5的策略，每次问询节点时，如果问询区间可以覆盖该节点区间，则进行温度的比较与赋值。如果两个子节点代表的区间和问询区间有交集，则递归查询。

**1.3.3 剪枝 **

​		使用kd树较快的原因是我进行了恰当的剪枝。由于本题只对最值进行查询，所以递归查询子树前，先判断温度有无修改的必要。如果子树的最低温度大于当前最低温度，最高温度低于当前最高温度，则不必递归。实际情况中，基于数据的随机性，剪枝可以实现很大的优化。

### **二、过程中遇到的问题及解决**

##### 1. 	未剪枝时，问询超时

```C++
由于kd-tree的复杂度是O(sqrt(n))的，我在大测试用例时会略微超时。之后我根据问题的最值特点，进行恰当的剪枝(见1.3.3)，解决了超时问题。
```

### **三、时间和空间复杂度估算**

##### **1. 时间复杂度**

​		kd-tree在问询时，每个节点最多伸出4个分支，即考虑递归的两步，最多将深入到4个孙子节点中，所以设时间为Q(n),最坏情况有
$$
Q(n) = 2Q(n/4) + 2, Q(1) = O(1)
$$

根据主定理有：
$$
Q(n) = O(\sqrt n)
$$
建树过程:设建树时间为B(n),由于每次建树都要对数据进行排序，所以有：
$$
B(n) = 2B(n/2) + O(nlogn)
$$
根据主定理有
$$
B(n) = O(nlog^2n)
$$
设问询数为m，总时间复杂度为：
$$
T(n) = B(n) + mQ(n) = O(nlog^2n  + m\sqrt n)
$$

##### 2. 空间复杂度

​		kd树每个节点占用的空间为O(1),所以总空间为：

$$
S(n) = O(n)
$$

